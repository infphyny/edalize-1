#Auto generated by Edalize

TARGET   := {{ name }}
CST_FILE := {{ cst_file }}
PNR      ?= {{ pnr }}
ARACHNE_PNR_OPTIONS := {{ arachne_pnr_options|join(' ') }}
NEXTPNR_OPTIONS     := {{ nextpnr_options|join(' ') }}
DEVICE   := {{  device }}

all: $(TARGET).{{ default_target }}
#timing: $(TARGET).tim
#stats: $(TARGET).stat

.PRECIOUS: %_next.fs %_arachne.fs

%.blif: %.mk
	$(MAKE) -f $<
%_arachne.asc: $(PCF_FILE) %.blif
	arachne-pnr $(ARACHNE_PNR_OPTIONS) -q -p $? -o $@
%.json: %.mk
	$(MAKE) -f $<
%_next.pack: %.json
	nextpnr-gowin -l next.log --device $(device) $(NEXTPNR_OPTIONS) --cst $(CST_FILE) --json $? --write $@
%.fs: %_$(PNR).pack
	gowin_pack -d GW1N-1 -o  $@ $^
#%.tim: %_$(PNR).asc
#	icetime -tmd $(DEVICE) $< > $@
#%.stat: %_$(PNR).asc
#	icebox_stat $< > $@

build-gui: $(TARGET).json
	nextpnr-gowin --device $(device) $(NEXTPNR_OPTIONS) --cst $(CST_FILE) --json $? --write $@ --gui

clean:
	rm -f $(TARGET).blif $(TARGET).json $(TARGET)_arachne.pack $(TARGET)_next.pack $(TARGET).fs
